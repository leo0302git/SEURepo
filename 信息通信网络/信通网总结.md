# 信息通信网络整理笔记

## 第一章 通信网络与服务

### 网络结构与服务的演进

通信网：提供不同位置用户间信息传递的一系列设备与装置

通信网的组成：

- 接入：连接用户终端设备与本地交换机之间的部分
- 交换：电路交换，分组交换，全光交换，软交换
- 传输

#### 电报网与报文交换

存储转发机制

① 消息达到电报站 ② 电报员存储消息直到目标通信线路可用 ③ 电报员将消息转发给下一个电报站

#### 电话网与电路交换

用户数为N时，专用电话网络需要(N-1)N/2,即N^2数量级的连接；而电路交换电话网络，只需要N个连接。

电路交换是面向连接的服务，信息传递之前需要先建立连接

电路交换的三阶段

1. 建立连接
2. 信息传输
3. 连接释放

#### 计算机网与分组交换

早期通过调制解调器走电话网络，以时分方式接入主机

计算机网络：阿帕网出现，路由提供无连接服务

因特网

**协议**：协议即约定两个或者多个通信实体之间信息交互的准则

IP协议：不能处理分组丢失，数据损坏和分组失序的问题

各子网络需要包含特定的分组交换机与网关路由器，并通过 网关与因特网的其他子网络进行通信

IP协议之上，有两种传输层协议（所有因特网应用都基于TCP 或 UDP）

UDP：使能信息块尽最大努力交付传输

TCP：使能字节流的可靠传输

### 通信网络发展的关键因素

技术、法规、市场、标准

## 第二章 计算机网络的层次化体系结构

### 2.1 OSI参考模型 

#### 2.1.1 七层模型 

![image-20241229145910966](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20241229145910966.png)

**物理层**：任务是在一条链路（信道）上透明地传输比特流

常见的物理层技术：Ethernet, DSL,  modems

**数据链路层**： 在直接相连的链路上，传输以帧(frames)为单位的数据

引入了编址的问题: 称为物理层地址，或者MAC地址

数据链路层常见功能

•差错控制: 发现差错;  解决差错 

•媒体接入控制: 

•流量控制 Flow control: 如果信息传输速率超过 了接收者的处理速率… 

•连接管理: 链路激活、维护，释放等操作

> [!NOTE]
>
> “物理层地址”不是物理层概念而是数据链路层概念

**网络层**的任务是在不同的链路上转发分组，主要功能是路由和转发

• 编址 

• 建立路由表：选择到目标节点最佳的下一跳节点 

• 根据路由表，将分组转发给对应的下一跳节点 

• 可能涉及到分片和重组 

• 拥塞控制Congestion control 

• 网络层的连接管理（when connection-based）

**传输层**：负责在终端的两个进程间传输数据。一般分为可靠传输（面向连接的）和不可靠的传输（面向无连接的）

“传输层负责端系统上不同进程间的消息传递. 而网络层负责传递到正确的端系统上”

主要功能

- 基于端口的寻址
- 流量控制和差错控制（与数据链路层还不一样）

**会话层**：数据的交换方式(如 半双工half-duplex, 全双工full duplex 等）, 数据同步控制点等等

**表示层**：数据的表示问题, 通常解决的是机器相关的表达与机器无关的表达之间的转换

**应用层**：提供应用层所需的服务. 如WWW业务, 浏览器使用HTTP应用层协 议获取文档

最顶端三层常常合并为应用层一层

#### 2.1.2 层，协议，及服务 

SAP: service access point, 服务访问点，通常是一个软件或硬件接口 

SDU: service data unit，业务数据单元 

Layer n entities: n层实体 

PDU: protocol data unit 协议数据单元，各层与对等层交换的数据单元

封装:  n+1’s PDU = n’s SDU        n’s PDU = n’sPCI+n’s SDU

高层的PDU成为低层的SDU

IDU: Interface Data Unit 接口数据单元，指相邻层经 过SAP点的数据

ICI: Interface Control Information 接口控制信息，指 IDU中的控制信息部分

PCI : Protocol Control Information 协议控制信息， PDU中的控制信息部分，体现了协议的控制消息

协议分层后的数据关系

![image-20241229151010575](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20241229151010575.png)

服务类型分类

无连接的（如UDP，IP）

- 直接进行SDU的传输
- 没有连接建立、维护、拆链的过程
- 服务的典型特征：无序、尽最大努力服务 (Best-effort)
- 提供确认的或非确认的服务

面向连接的（如TCP，ATM）

- 连接建立的三个阶段： 1.待建立连接的SAP之间启动连接，并初始化连接状态 2.传输SDU 3.拆除连接
- 服务的典型特征：有序、可靠
- 提供确认的（confirmed）服务

**分片和重组**

当高层的数据量太大时，发送时将之拆为若干个**分片**，接收时**重组**恢复会原始大小

**组块与分块(Blocking and Unblocking)**

发送时，将多个高层 PDU（即本层SDU）组合为一个数据块整体发送； 接收时，将该数据块恢复为原始的若干小数据块

**复用与解复用Multiplexing & Demultiplexing**

多个高层协议可以共用同一个低层的服务.解复用时通过解复用键值来区分高层协议

**分裂/整合 Splitting/Recombining**

若干个低层同时为一个高层提供服务

**OSI小结**

协议是水平的，对等层都认为自己在直接与对方通信

服务是垂直的

![image-20241229151900734](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20241229151900734.png)

![image-20241229151910855](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20241229151910855.png)

有时用数据包统称三层及以上的数据

### 2.2 TCP/IP参考模型 

#### 2.2.1 TCP/IP 协议栈结构 

![image-20241229152050236](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20241229152050236.png)

套接字

套接字是应用程序与协议栈交互的手段，协 议栈提供一系列函数调用（SAP点）。创建套接字时， 会关联本地IP地址、协议类型（TCP/UDP），端口号。 套接字与创建它的进程（程序） 关联。

例如，源套接字: (TCP, (B.2), C)    //TCP是协议类型，C表示 某端口 ；目的套接字: (TCP, (A.1), 80) 两者的组合: (TCP, (B.2), C, (A.1), 80) ，又称五元组

### 2.3 ATM体系结构

![image-20241229152442978](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20241229152442978.png)

## 第3章  交换技术基础

![image-20241229152753961](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20241229152753961.png)

### 3.1  电路交换 

- 专用的资源：无共享 
- 类似于电路（有保证的）性能 
- 需要呼叫建立
- 网络资源（如带宽）分割为片，分配给呼叫，不用时就处于空闲，因为不共享

时延分析

![image-20241229153020963](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20241229153020963.png)

电路交换网时延计算例题p13

### 3.2  报文交换 

- 每个端到端数据流采用报文传输  
- 用户A、B的报文共享网络资源 
- 每个报文使用全部链路带宽 
- 按需使用资源，存在资源竞争，如报文排队

### 3.3  分组交换 

- 每个端-端数据流划分为分组
- 用户A、B的分组共享网络资源 
- 每个分组使用全部链路带宽 
- 按需使用资源 

报文交换和分组交换都使用了存储转发机制。采用存储转发方式的分组交换兼有电路交换和报文交换的优点，它与报文交换的不同在于：分组交换将用户要传送的信息分割为若干个分组（packet ）， 每个分组中有一个分组头，含有可供选路的信息和其他控制信息。

分组交换的延时

- 节点处理延时：校验比特错误，确定输出链路
- 排队延时：在输出链路中等待传输的时间
- 传输延时：发送比特到链路上的用时
- 传播延时：距离/速度

分组交换的两种不同形式的服务：虚电路(cirtual circuit)和数据报(datagram)

#### 虚电路

发送第一个数据包之前，先要等待一个完整的RTT用于建立连接，预约资源

![image-20241229154148589](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20241229154148589.png)

#### 数据报

无等待连接建立的RTT延时；主机一旦准备好，就可以发送数据。无连接，不可靠

![image-20241229154243141](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20241229154243141.png)

三种交换机制的延时比较

![image-20241229154422828](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20241229154422828.png)

### 3.4  网络中时序

电路交换时序

![image-20241229154609743](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20241229154609743.png)

数据报型分组交换延时

![image-20241229154859452](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20241229154859452.png)

虚电路型分组交换延时

![image-20241229155017307](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20241229155017307.png)

可以看到就比数据报型分组交换多了三个ML（三个单程传播总延时）和三个单程处理总延时(M-1)P

> [!NOTE]
>
> 我们通常只对如下延时感兴趣，即从发送方发送第一个比特的时刻 开始，到接收方接收最后一个比特的时刻结束（我们排除了连接结束 的应答时间）。如果是这种情况，前面的计算式中，系数"4"都改为"3"

结论：

- 随着传输速度的进步，总延时由传播延时占主导，这是光 速限制的结果。
- 当链路速度慢时，瓶颈是链路的传输速度。消除存储、转发对降低 时延有帮助，额外的（建立、拆除连接）往返延时可忽略。因此，使用电路交换技术降低了网络总延时。
- 当链路速度快时，瓶颈是传播延时。附加往返延时的影响大，消除存储、转发的延时可忽略。因此，使用电路交换技术增加了网络总延时。

## 第四章 数据传输基础

### 4.1 信息的数字表示 

假设模拟信号带宽为W，最小采样速率为2W。量化比特数n越多，量化精度越高，传输所需速率越高。如电话语音W=4kHz,采样频率为8kHz，8bit量化，则传输速率为8*8k=64kbps

### 4.2 数字通信 

设信道带宽W，不考虑符号间干扰，则最大脉冲频率：
低通信道：2W pulses/s
带通信道：W pulses/s

低通信道对于多级脉冲传输，如果幅度级M=2^m，则比特率为2mW bps
带通信道减半即可

### 4.3 线路编码 

考虑因素

- 需要避免低频分量
- 发送功率尽量小
- 定时问题：信号跃变有助于定时
- 带宽效率：跃变越多，带宽需求越多
- 实现起来的复杂性
- 差错检测能力

![image-20241229161607122](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20241229161607122.png)

各自缺点：NRZ低频多、Bipolar拥挤在T/2，Manchester带宽浪费严重

#### 单极性不归零编码NRZ

- 平均功率高$\frac12 A^2 + \frac12 0 = \frac 12 A^2$
- 长 A or 0：定时性能差，且有低频分量 
- Simple

#### 双极性不归零编码polar NRZ

- 平均功率低$\frac12 (0.5A)^2 + \frac12 (-0.5A)^2 = \frac 14 A^2$
- 长 +A/2 或 –A/2 :定时性能差，且有低频分量 
- Simple

#### 双极性编码Bipolar Code

- 有{A,0,A}三个信号等级，“1”交替映射到 +A or –A ，“0”映射为0电平
- 低频分量少
- 连续的1序列编码为方波，频谱集中在T/2
- 长0时容易失去同步

#### 曼彻斯特码和mBnB码

- 映射关系：首T/2“1” -> A/2 , 后 T/2 -A/2；首T/2 “0” -> -A/2 , 后 T/2 A/2  
- 每个比特都在中间有个跃变：定时性能好；带宽*2 
- 易于实现

mBnB码就是将$2^m$个数映射到n个比特上的编码方式。Manchester是1B2B码

#### 差分编码 Differential Coding

- 极性反转 +A 变成 –A 或相反 
- 对于极性反转错误，差分线路编码提供了鲁棒性 
- “1” 映射成跃变 ,“0” 保持不变 
- 带宽性能不变 
- 差错成对出现
- 既可以用于NRZ也可以用于Manchester

### 4.4 调制解调  

ASK，FSK，PSK，略。

### 4.5 传输媒介

基本问题：信息承载能力（幅度、带宽和抗干扰性）和信号传播速度

#### 衰减效应

有线媒体具有指数依赖性，衰减 Attenuation in dB = kd

无线媒体具有对数依赖性，Attenuation in dB = n log d

## 第五章 对等协议和数据链路层

数据链路层的功能

- 成帧、访问控制
- **相邻节点间**的可靠传输
- 差错检测、纠正和控制（确认，定时器与序号）
- 流量控制
- 半双工和全双工

### 5.1 检错与纠错 

系统预先规定一些传输模式，所有传输数据块符合某种特定的模式。如果接收到的数据块不符合该模式，则判定出错。

所有的纠错与检错方法都基于冗余。设想如果没有冗余，每一种比特组合都是合法模式，那就没法知道某一个接受到的模式是本来就这样还是由其他模式出错导致的。

差错控制编码分为纠错编码和检错编码。重传有ARQ : Automatic Repeat Request和FEC : Forward Error Correction

#### 如何评价码的好坏

汉明距离Hamming Distance --两个等长码组之间相应位取 值不同的数目

- 检测e个比特的错误，要求码的最小距离≥e+1

将一个3 bit码字一一地映射到一个3维空间，则所有可能的比特组合共有8种，对应8个点。如果要检测一个bit的错误，则设置的合法点之间的最短汉明距离应该为2.如果为1，那么至少有两个合法点之间距离为1，那么如果接收到这两种码字中的任何一种，都无法判断是本来发的就是这个还是由其他码字出错得到的。

- 纠正t个比特的错误，要求码的最小距离≥2t+1

沿用上面的例子，如果要纠正一个比特的错，则设置的合法点之间的最短汉明距离应该为3.如果为2，比如有两个合法点为(0,1,1)和(0,0,0)，那么当接收到(0,1,0)时，虽然知道肯定是由(0,1,1)或(0,0,0)错过来的，但没法知道是由哪个错过来的。而如果最近的两个合法点为(1,1,1)和(0,0,0)，接收到(0,1,0)，由于知道只错了1bit（这是基于1bit出错的题设的），所以可以纠正到(0,0,0)

- 纠正t个同时检测e(≥t)个随机错误，则要求码的最小距离 ≥t+e+1

#### 错误的类型

单比特错误

突发错误：突然出现一连串的比特错误。交织是一种抗突发性错误的有效手段，把信道上突发错误在时间上扩散开，转化为独立的随机错误，这样纠错码就可以应用于突发错误信道，充分发挥纠错码的作用。纠错码对抗随机错误，交织编码技术可以同时解决信道随机错误和突发错误。

#### 奇偶校验码

##### 一维奇偶校验码

在k比特信息位之后附加一个校验位以构成码字

开销：1/(k+1)

覆盖范围：50%（随机误差向量模型。 如： e=[0 0 0 0 0 0 0 0]和e=[1 1 1 1 1 1 1 1]出现的概率是相等的）

- 所有改变奇数个比特的错误都可以被检测出来 
- 所有偶数个比特的错误模式都无法被检测出来

随机误差比特模型：各比特间发生错误的概率相互独立，单比特错误概率为$p$

只发生一个bit出错的概率$P(w(e)=1) = (1-p)^{n-1} p$

发生2个bit出错的概率$P(w(e)=2) = P(w(e)=1) \frac{p}{1-p} <P(w(e)=1)$

发生k个bit出错的概率$P(w(e)=k) = P(w(e)=1) (\frac{p}{1-p})^{k-1} <P(w(e)=k-1)$

一维奇偶校验漏检的概率$(2bit出错的情况数)\times P(w(e)=2) + ... + (2kbit出错的情况数)\times P(w(e)=2k)+... , k =1,2,3,...$

其中j bit出错的情况数可表示为$C_j^n = \frac{n!}{j!(n-j)!}$​

##### 二维奇偶校验码

生成：

![image-20250103191459274](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20250103191459274.png)

检查

![image-20250103191514611](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20250103191514611.png)

- 检测所有1-，2-，3比特的和一些4-比特的错误
- 纠正所有1比特错误

##### 其他检错码

**Internet校验和**：在IP，TCP，UDP中使用的检错方式。无法检测失序字节，可以检测所有奇数个比特错误和绝大部分偶数个比特错误

发送方

- 将IP/TCP/UDP的包分成多个n比特的块
- 将其利用1的补码的方式相加，相加的结果保持n比特的长度
- 将结果取反，得到所需的校验和，随数据一起发送

接收方

- 将数据切分成k块n比特长度的数据块
- 将数据块通过1的补码的方式累加 
- 将和取反，若所得的和是0，数据被接受，否则拒绝

**循环冗余校验码**CRC（多项式编码）

利用移位寄存器实现。首先，将二进制向量映射为多项式，从零次项开始。多项式的加、乘、除与一般类似，但是加法是在模2意义下进行的。(x+x=0)竖式计算中没有减法也没有借位，都是加法，没有进位。

n比特的码字： n – 1阶多项式.所有的码字都满足以下模式
$$
b(x) = x^{n-k}i(x)+r(x)=q(x)g(x)+r(x)+r(x) = q(x)g(x)
$$
所有码字都是**生成多项式**g(x)的倍数.接收方需要除以g(x)，并检查余数是否为0。若余数非0，那么接收到的n维元组不是合法的码字

接收用除法电路

![image-20250103194503154](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20250103194503154.png)

无法被检测到的错误模式：设加性错误多项式为$e(x)$如果$e(x)$可以被$g(x)$整除，则错误无法被检测到

### 5.2 ARQ协议和可靠数据通信

ARQ(Automatic Repeat Request) 目的：即使数据在传输过程中出错，ARQ协议的检错和重传机制也能够保证数据被正确传送到接收端

§5.2.1 停止等待协议：SWP ( Stop-and-Wait) 

帧头需要加入序号，$S_{last}$代表最近一次传输的帧的序号，$R_{next}$是接收方期待接收到的下一帧的序号，隐含了对所有前序帧的确认。对于发送方来说，序号正确的情况是R_next = S_last+1，因为发送方最近一次传输的帧号是S_last，对面若正确收到，给的是下一帧期望的序号；对于接收方来说，正确的情况是S_last=R_next，因为对接收方来说，这表明发送方收到了我对下一帧的期望并以此发来了我想要的帧。

理论上1bit的序号就已经足够，如果有两bit，可以刻画全局状态(S_last,R_next)

时序分析

![image-20250103195949093](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20250103195949093.png)

有效的信息传送率,($n_o$: frame overhead)
$$
R_{eff}=\frac{n_f - n_o}{t_0}
$$
传输效率
$$
\eta_0 = \frac{R_{eff}}{R}=\frac{1-\frac{n_o}{n_f}}{1+\frac{n_a}{n_f}+\frac{2(t_{prop}+t_{proc})R}{n_f}}
$$
时延带宽积$2(t_{prop}+t_{proc})R$，它表征了（来回的）传输管道容纳信息的容量。时延带宽积越大，效率越低，常见于高速或长传播时延的信道中。

如果假设帧无差错传输的概率为1 – Pf，错误的帧要丢弃重传，那么平均传输时间变为$t_0/(1-P_f)$​，传输效率变为
$$
\eta_SW = \frac{R_{eff}}{R}=\frac{1-\frac{n_o}{n_f}}{1+\frac{n_a}{n_f}+\frac{2(t_{prop}+t_{proc})R}{n_f}}(1-P_f)
$$
假设一个比特出错的概率为p，由于帧中有$n_f$个比特，所以
$$
1-P_f = (1-p)^{n_f}\approx e^{-n_f p}
$$
当$n_f p$趋近于1时，差错率开始影响性能

§5.2.2 后退N帧协议：GBN ( Go Back N )  

- 一直发送帧，从而保持信道的繁忙,通过不等待的方式，提升停止等待ARQ的性能
- 窗口长度应足够长以覆盖一个往返时间(RTT, round trip time)
- 对于发送方，如果一个帧的窗口耗尽后还没有收到ACK，那么需要重发这个帧及其以后的所有帧

基础的后退N帧ARQ存在如下问题：如果帧在传输过程中丢失，且后续没有帧需要传送，那发送窗口将不会被耗尽，这将导致重传不会发生。解决方法：对每一帧都设置一个定时器，当定时器超时时，重发没有被确认的帧

窗口不是定时器，应该理解为发送方一次性能发送帧的最大数量，超过这个数量后，帧编号会重置。

最大窗口尺寸: $W_s = 2^m -1$.超过这个尺寸可能会发生如下错误：

![image-20250105173613444](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20250105173613444.png)

接收方的所有ACK全部丢失，发送方重发这个窗口，第二个窗口最先到达接收方的帧号是0。但是接收方最后一个ACK发的也是0，所以接收方不知道又接收到的这个0号帧是上一个窗口的还是新窗口的

双向GBN中的捎带确认ACK（ **Piggybacking** ）

在收发双方的帧中,都有对对方的下一帧期望$R_{next}$. 超时时间应该设置为$T_{out} = 2 T_{prop} + 2T_f + T_{proc}$(没计入接收方的处理时间,也没计入发送方的传输时延)

![image-20250105174221116](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20250105174221116.png)

如果算上接收方的处理时间和发送方的传输时延,$T_{out}= 2 T_{prop} +T_{f1} +2T_{f2}+ 2T_{proc}$

![image-20250105174455825](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20250105174455825.png)

GBN 的效率

如果一个帧传送成功的概率为$1-P_f$,传送一帧的时间为$t_f$.考虑到发一个窗口,如果里面的一个帧没传送成功,以这个帧为起始的窗口都要重发(因为窗口时间耗尽后发送方没有收到ACK),所以,发送一个帧的时间为

![image-20250105175123934](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20250105175123934.png)

拆开等比数列求和得到
$$
t_{GBN} = t_f +p_f \frac{w_s t_f}{1-p_f}
$$
对于较大的时延带宽乘积，GBN的效率相比于停止等待协议，有较大的提升;随着比特错误率的上升，GBN的效率降低

§5.2.3 选择重传协议：SRP (Selective Repeat Protocol)

只重传单个帧

接收方要维护一个接收窗口，接收可能是失序的，只接受序号处在窗口内的帧并缓存，当接收到序号为R_next的帧时，窗口向前滑动1个或多个

$W_s + W_r = 2^m$​是最大允许的窗口大小

TCP用了SRP

选择重传ARQ的效率
$$
\eta_{SR}=\frac{\frac{n_f - n_o}{t_f/(1-P_f)}}{R}=(1-\frac{n_o}{n_f})(1-P_f)
$$
![image-20250108211816746](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20250108211816746.png)

###  5.3 滑动窗口流量控制

传送开/关流量控制：当接收方的剩余的Buffer还有2T_propR的时候，即要启动OFF(画图理解)

滑动窗口流量控制：通过ACKs将窗口向前滑动的形式，可以看做是允许传送更多帧的命令

### 5.4 成帧 

帧和物理层的比特流需要相互转换，有如下方式进行帧定界

- 字符计数
- 特殊字符
- 特殊比特组成的标志
- CRC校验

#### 面向字符的成帧

帧的信息段为整数字节。用特殊的8比特字符作为控制字符：起始控制字符：STX (start of text) = 0x02; 结束字符：ETX (end of  text) = 0x03;

用特殊的转义字符（DLE，data link escape）来实现透明传输 ： DLE (data link escape) = 0x10  利用DLE STX (DLE ETX) 来指示帧的开始与结束  在帧中出现DLE时，在其前面加上DLE 129 因此，**除了在帧边界处，其他所有的DLE都会成对出现**

![image-20250108213329808](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20250108213329808.png)

#### 面向比特的成帧

 帧的边界由8比特的标志划定 (01111110)，发送方在出现联系的5个1之后，会加入一个多余的0 。接收方在接收到连续5个1时： 如果下一个比特是0，则是添加的，将其移出；如果下两个比特是10，则是标志位。如果是11，则出现了错误

#### PPP中的字符填充

PPP是面向字符版本的HDLC。PPP的帧头尾标志是 0x7E (01111110) 。控制转换字节为 0x7D (01111101) 任意在帧内出现的标志或控制字节都会被（即0x7D + 原始字段与0x20做异或）取代

![image-20250108214055927](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20250108214055927.png)

### 5.5 高级数据链路控制（HDLC：High-Level Data Link Control） 

## Chapter 6  Medium Access  Control protocols and  Local  Area Networks

### 共享介质

两个站点之间试图共享截止，需要$2t_{prop}$的安静时间，即一个往返时延，站点 B在站点A发送前、后需要t_prop时间保持安静.

传输效率
$$
\rho_{max}=\frac{L}{L+2t_{prop}R}=\frac{1}{1+2a}
$$
L表示L bit/frame，每帧包含的比特数，R是比特传输速率。上式可以这么理解：发送一帧中，分子是帧比特数，分母是如果没有等待能够传输的比特数。最大吞吐量$R_{eff}=\rho R=\frac{R}{1+2a}$.这里定义了归一化时延带宽积
$$
a = \frac{t_{prop}}{L/R}
$$
分子单位：秒每帧

### 随机接入

#### ALOHA

最简单的方案: 有就发

- 性能指标 
  - 吞吐量 
  - 时延 
- 与吞吐量分析有关的参数 
  - X:  帧发送时间(假设常数)  
  - S:  吞吐量 (每X秒内平均发送(成功)的新帧的个数) 
  - G:  负载 (每X秒内平均发送的(包括成功和失败的)所有帧的个数) 
  - P_success :  一个帧成功发送的概率

$$
S = GP_{success}
$$

假设X秒内平均发送G个帧，这段时间里实际到达了k个帧，这种情况发生的概率是$P(k)=\frac{G^k e^{-G}}{k!}$​.

若帧长为L，发送速率为R，那么考虑X=L/R,一个从to开始发送的帧，该帧成功传输的条件是没有与其它帧冲突。任何在[t0-X, t0+X]内发送的其它帧将导致冲突。定义易损期 vulnerable period = [ t0 – X, t0+ X ],时间长度为2X

现在把P(k)中的G换成2G并代入k=0即为不冲突的概率，也即发送成功的概率
$$
S=GP_{success}=Ge^{-2G}
$$
求导令其为0，可得在 G=0.5时达到大吞吐量，为$\rho_{max}=1/2e = 18.4\%$

G很大时，冲突会引起滚雪球导致吞吐量迅速下降至0

**ALOHA 最大吞吐量 = 18.4% 信道容量**

> [!NOTE]
>
> 最大吞吐量的量纲是帧/秒，信道容量的单位是比特/秒，中间差了一个每帧的比特数

#### 时隙ALOHA

站点只能在时隙的开始发送帧，且站点之间同步。当一个站点有新帧要发, 它等到下一个时隙开始的时刻发送。如果发生冲突, 站点等待一个退避时间后重新发送该帧（退避时间 = 帧 长的整数倍)

考虑在时隙[k,k+1]内某个准备完毕的任意帧P，它将在k+1时刻发送。如果有其他帧在[k,k+1]时间段内准备完毕，则该帧不能成功发送。所以易损期是[ t0 – X, t0 ]
$$
P_{success}=e^{-G}\\
 S=GP_{succ}=Ge^{-G}
$$
当G=1时达到最大，Smax=0.368，当G>1时，称该信道是超载的

 **时隙ALOHA 最大吞吐量 = 36.8% 信道容量**

#### 载波侦听多址接入Carrier Sensing Multiple Access

站点在发送前侦听信道。 如果信道空闲则发送整个帧；如果信道忙碌则随机退避一段时间并重新侦听信道。分为3类

- 1-坚持 CSMA：一旦信道空闲就立刻发送，低时延低效率。吞吐量随G的增加而下降的更加明显，因为大家都急着发，更加剧冲突
- 非坚持 CSMA：等待一个退避时间然后再次侦听，高时延高效率
- p-坚持 CSMA：信道空闲时以概率p发送，或以概率（1-p）退避一个最短时隙mini-slot并重新侦听

> [!NOTE]
>
> 当传播时延大于帧传输时延时，CSMA相对于ALOHA并无增益。可以这样理解：当传播时延越大，站点捕获信道的代价越大

#### 具有冲突检测collision detection的CSMA：CSMA-CD

有帧要发送的站点，首先进行载波侦听发送开始后，站点持续监听信道并检测是否有冲突。如果检测到冲突，所有正在发送帧的站点发送一个短的干扰信 号并停止发送（这与CSMA不同），重新设定退避时间，等待后重新试着发送（侦听…）

CSMA-CD确定信道是否被捕获的用时介于[t_prop, 2t_prop], 如果还考虑强化碰撞的人为干扰信号用时，则介于[t_prop+T_j, 2t_prop+T_j]之间

时延模型

征用一次信道需要2t_prop时间，即每个竞争时隙长度为2t_prop.
假设有n 个站, 每个站在竞争时隙（contention time slot）内以概率p发送数据 
当竞争期结束时（某个站成功捕获信道）, 它还需要 X 秒将帧发送出去(传输时延)
在下一次竞争期开始前需要t_prop时间(因为发完之后还要等帧完全到达另一端)

争用被解决（“成功”）的条件是：在某个时隙内仅有1个站点发送
$$
P_{success}=np(1-p)^{n-1}
$$
当p=1/n时成功概率最大，为1/e，所以平均需要e个时隙来解决征用，所以平均征用时间为2t_prop e。系统效率
$$
\rho_{max}= \frac{X}{X+t_{prop}+2et_{prop}}=\frac{1}{1+(2e+1)a}\\
a = \frac{t_{prop}}{X}
$$
理解：本来传一个帧本身只要X秒，但是因为传播时延和解决征用，所以分母上多出两项

对于较小的a，CSMA-CD的吞吐量大；对于较大的a，ALOHA和时隙ALOHA的吞吐量更大（但其效率与a无关）

### 调度

#### 预约方式

将传输分为多个循环周期，每个循环周期分为预约间隔和帧传输两个功能。预约间隔为每个站点分配了一个微时隙（minislot）来请求传输。某个周期的长度对应有帧要发送的站点的个数

预约的方式有多种：时隙ALOHA预约方法、单帧预约、多帧预约

#### 轮询方式

一个设备被指定为主站 primary station (中心控制器central controller) ， 其它设备被指定为从站secondary stations。

系统具有两条线路：带外线路outbound line – 用来从主站到从站发送数据；带内线路inbound line – 从来从从站到主站发送数据，所有从站需共享该线路 

中心控制器按照循环的方式发送轮询消息 ‘polling messages’ 到从站，问询它们是否有帧要发。从站只有当被中心控制器问询到才能发送帧，所以在给定时间，仅有一个从站有权发送帧。从站发送‘go-ahead message’来指示帧传输已经完成 ，中心控制器收到该消息后，将轮询下一个从站

#### 令牌传送系统

帧传输的许可称为令牌（Token）

当不发送帧时, 每个站的接口就像转发器一样工作：它将所有从输入端口进来的比特复制到输出端口 

当站点收到一个空闲的令牌且有帧要发时，其接口将令牌修改为“忙碌”状态并进行发送模式 

当传输结束时，令牌被再次修改为“空闲”。

令牌持有时间Token Holding Time：一个站能够持有令牌时间的上限 (i.e.  它决定了一个站一次最多发送多少数据)

#### 小结

**随机接入与调度接入的比较**

![image-20250109173917499](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20250109173917499.png)

**随机接入方式比较**

- Aloha & 时隙 Aloha 
  - 在低负载情况下简单和快速传输 
  - 支持大量突发、短数据的用户 
  - 中等负载情况延迟变化很大 
  - 效率与a无关 
- CSMA-CD 
  - 对于低时延带宽积情况，能够快速传输，具备高效率 
  - 支持大量突发数据用户 
  - 可变和不可预测的延迟

**调度接入方式比较**

- 预约 
  - 按序传输突发或稳定的数据流 
  - 使用时隙ALOHA预约，可支持大量低业务负载用户 
  - 可支持QoS 
  - 使用延迟的许可，可应对大的时延-带宽积 
- 轮询
  -  时分复用的广义形式 
  - 提供公平性 
  - 可设定最大接入时延 
  - 当时延-带宽积很大时，性能下降

### 局域网

特性:

- 私有性：不受广域网的管制限制
- 短距离（~1km） 
  - 低成本，单一的传播媒介 
  - 相对较少的站⇒不需要复杂和昂贵的交换设备 
  - 高速、相对无误差的通信⇒不需要复杂的错误控制
- 移动性：站点可能经常移动位置 
  - 给每个站点指定一个唯一地址 
  - 消息在网络中广播
- 需要一个介质访问控制协议

局域网只对物理层和数据链路层进行了规范，不涉及网络层及以上层。

IEEE 802标准体系结构中，数据链路层又被分为两个子层： 介质访问控制子层MAC和逻辑链路控制子层LLC

#### IEEE802.3 MAC

- 最大段长500m 使用4个中继器 最大距离2500 [m] 
- R=10 Mbps运行 
- c≈2\*10^8 [m/sec] 2\*tprop +中继器延迟≈ 51.2 μs (minislot!) ⇒ 512bits
- 最小帧长= 512 bits = 64 bytes = 46 + 18
-  最大帧长= 1518 bytes = 1500 + 18 (防止一个站垄断媒介)
- 对于给定的最小帧长，比特率每增加10倍，最大距离就减少到1/10

IEEE 802.3 MAC Frame(类型1)

![image-20250109190013377](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20250109190013377.png)

DIX 以太网（Ethernet II）帧结构（类型2）

![image-20250109190038532](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20250109190038532.png)

IEEE 802.3 Physical Layer

![image-20250109191009554](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20250109191009554.png)

- 粗(10mm)同轴电缆以太网–难于操作和安装 
- 细(5mm)同轴电缆以太网 –更便宜，更容易操作,但每个段的长度不能超过 200 m,这是由于细同轴电缆的高衰减水平 
- 非屏蔽双绞线以太网–低成本，办公室普遍应用，但由于双绞线传输质量差， 单个链路的长度被限制在100米. 10baseT的拓扑结构在逻辑上是星型，实际上是总线型

快速以太网，传输速率变成十倍，帧发送时间减少为1/10，为了CSMA-CD的往返传播延时小于帧传输延时，要么增加最小帧长为原来的10倍，要么缩短站与站之间的最小距离至1/10. 定义了一系列新的物理层规范

![image-20250109191423738](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20250109191423738.png)

-  相同的帧格式，相同的接口，相同的协议 
- 集线器拓扑且只有双绞线和光纤 
- 放弃了总线拓扑和同轴电缆
- 使用4B/5B块编码和MLT-3线路码（代替曼彻斯特编码）来减小带宽需求

千兆以太网（吉比特以太网）-- IEEE802.3z  & IEEE802.3ab

![image-20250109191607791](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20250109191607791.png)

- 时间增加到512 字节 (而不是 64 字节) 小帧需要扩展到512 B 
- 帧突发（frame bursting）允许站点传输突发的短帧 
- 框架结构保留了下来，但CSMA-CD实质上被抛弃了（a的限制不好满足了）

10 Gigabit Ethernet  -- IEEE 802.3ae

![image-20250109191745568](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20250109191745568.png)

-  仍保留之前的帧结构 
- CSMA-CD 协议被正式放弃 
- LAN PHY 被用于本地网的应用

### 802.5 令牌环网

- 单向环网：物理上是星型，逻辑上是环形（这样可以绕开故障站点，但是不能避免集线器的单点故障）
- 双绞线实现，4M-16Mbps速率
- 差分Manchester编码
- 最多250个主机

###  802.11  无线局域网

无线局域网不适用CSMA-CD的原因

- 在无线电环境中很难检测到碰撞——同一站的发射功率远远超过接收功率，且接收信号易受干扰 
- 隐藏终端问题–发射信号的多个站点超出彼此的范围(信道实际忙，但探测到空闲，间隔很远的两个发射点都没收到对方的微弱信号，以为信道空闲，这时接收机就会同时收到两个发射机发来的信息) 
- 暴露终端的问题-发射信号的多个站点在彼此的范围内，但接收器不在！（信道实际空闲，但探测到忙，因为发射器之间可以相互检测到）

解决办法是：使用RTS(Request To Send)和CTS(Clear To Send)信号

对于隐藏终端问题，假设A想发送给B一个帧，B的接受范围内可能有其他站点比如C也想发给B。为了避免这种情况，由A发送RTS，内容包括:源地址、目的地址和这次通信 （包括相应的确认帧）所需的持续时间。B用CTS响应，在B传输范围内的所有站点都知道A已经捕获信道了，于是知道要保持沉默。

> [!NOTE]
>
> 注意，RTS帧也可能发生碰撞，但是由于它很短，所以比数据帧发生碰撞要好一些

对于暴露终端问题。情景是：B正在给A发，C想给D发，但是害怕自己的发送会在A处造成碰撞。这时候B发RTS，A，C都收到了，A给出CTS，B能收到但C收不到，那么C只收到一个RTS，就知道C的发送不影响A的接收，于是C也发送RTS，D发送CTS，C接收到CTS, C发送数据

![image-20250109193813807](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20250109193813807.png)

前述无线局域网的MAC协议又称为CSMA-CA(collision avoidance)。RTS/CTS的使用只是CSMA/CA的一个可选部分。 CA并不是指RTS/CTS的使用，而是指当中转站发现信道繁忙时回退的情况。回退方法类似于非坚持CSMA。

### 局域网桥接

当两个或多个网络在物理层互联时，互联设备称为中继器/集线器；MAC层/数据链路层的互联设备叫网桥；网络层互联设备叫路由器，更高层的叫网关。

当互联仅涉及范围扩展时，中继器就可以解决问题，但是不能解决局域网饱和问题。为了缓解饱和，一种方法是把整个网络分成几个碰撞域，这就用到了网桥

网桥的一般问题

- (各种网络) MAC 帧格式的差异 
- 数据速率、缓冲、定时器的差异 
- 最大帧长的差异

#### 透明网桥

1. 缓存：网桥接收到数据帧后，会先将其缓存起来进行处理。 
2. 学习：网桥会检查数据帧的源MAC地址，并在网桥表中进行 查找。如果源地址不在表中，网桥会将该地址和对应的端口信息加入到表中，这个过程称为逆向学习法。（这样就知道一个地址是从哪边来的了） 
3. 过滤：网桥会判断数据帧的目标地址是否在发送帧的同一网 络段内。如果是，网桥不会将帧转发到其他端口。 
4. 转发：如果目标地址位于不同的网络段，网桥会将数据帧转 发到正确的网络段。 
5. 泛洪flooding：如果网桥表中找不到目标地址，网桥会将数据帧发送到除了来源端口之外的所有端口。

> [!NOTE]
>
> 填表题易考

![image-20250109201458273](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20250109201458273.png)

实际网络中，网络拓扑结构可能一直在发生变化，可以引入计时器来老化表项，令其重新学习。接收一个帧，如果它的信息与之前相同，则刷新TTL(Time to live)，反之立即更新。

如果局域网有环路，学习过程中的泛洪可能导致循环广播（广播风暴），为此引入生成树算法消除环路。

根网桥->根端口->指派网桥->指定端口->设置根端口和指定端口为转发态，其余为阻塞态

![image-20250109202850239](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20250109202850239.png)

#### 源路由网桥

透明网桥将实现复杂性交给网桥处理，源路由网桥结构则交给端设备处理。端设备在想要向另一个端设备发送帧时，首先查找本地路由，自己决定路由，并将路由信息包含在帧头部，网桥只需要按需执行即可。如果本地没有路由，则需要查找路由（发现路由）

1. 为了发现到目的地的路由，每个站点广播一个单路由广播 帧single-route broadcast frame 
2. 帧访问每个局域网一次并最终到达目的地（用到了生成树）
3. 目的地发送全路由广播帧all-routes broadcast frame ，该帧生成所有路由返回到源 
4. 源收集路线并挑选最佳路线

![image-20250109203827308](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20250109203827308.png)

“透明”指的是站点完全不了解网络中存在网桥的事实

#### 虚拟局域网 VLAN

一个或多个LAN上的一组设备，被配置为可以像连接到同一条线路一样进行通信，而实际上它们位于许多不同的LAN段上。

实现了物理拓扑和逻辑拓扑的分离

## Chapter 7 分组交换网

7.1  网络服务 和 网络内部操作 7.2  分组网络拓扑 7.3  数据报和虚电路 7.4  分组网络中的路由选择 7.5  最短路径路由

网络服务与网络操作是两个不同的概念，它们各自都可以是面向连接或无连接的

网络层功能

- 路由
- 转发
- 优先级和调度
- （可选：）拥塞控制、分段重组、安全功能

### 分组交换网两种基本方法（服务）

为什么需要分组交换：

- 发送信息块出错概率随着信息块长的增加而增加，长报文导致很高的重传 率 
- 报文交换也不适合交互式应用：长报文的发送，给其他报文到来很长的等 待延时。分组交换更适合交互应用。

分组交换时延：分组流水线传输能使消息到达更快。

#### 数据报

- 无连接的分组交换
- 分组需要标识出完整的目标地址，并在路由器处独立的选择路由，因此分组可能沿不同路径传输
- 路由表可能很大，不便维护、查找
- 典型实例：IP

#### 虚电路

- 面向连接的服务
- 在源和目的端之间建立一条网络层意义上固定的路径，称为虚电路或虚连接。这与电路交换建立物理层意义上的路径不同
- 虚电路建立过程需要确定通过网络的一条路径
- 虚电路分组交换可以保证分组的次序
- 优点
  - 可以使用缩略报头，通过分组中的携带的VCI(virtual circuit identifier)来访问路由表，而不是通过源和目的端的完整地址，减少了需要操作的比特数，更快
  - 资源可以在呼叫建立过程中被分配
- 缺点：出现故障时，所有受影响的连接都要重新建立
- 典型实例：ATM

### 分组网络中的路由选择

对路由算法的要求

- 快速而准确转发分组
- 迅速响应变化 ① 适应网络故障引起的拓扑变化； ② 适应网络负载变化； ③ 避开拥塞路径的能力； ④ 确定网络连通性能力； ⑤ 避免环路能力； 
- 最优化 
- 冗余性 
- 简单易于开发

路由算法的分类

- 静态路由：专用主机离线计算，生成路由表后改变较少，胜任变化性不大的网络和简单网络；不能对故障做出及时反应
- 动态路由：定期交换信息并更新，能适应网络动态变化，但是复杂

路由算法的另一种分类

- 集中式路由：所有节点发送状态信息给中心，由中心负责计算所有路由。很难适应网络频繁拓扑变化；无扩展性
- 分布式路由：路由之间定期交换状态信息；自适应网络拓扑结构及其他变化；更好的扩展性；缺点是容易产生不一样的路由结果，导致生成环路

### 路由表

- 对于虚电路而言，路由表将每一个进入的VCI转换为一个输出的VCI，基于VCI来确定输出端口。 链路标识VCI只具有局部意义：采用本地VCI而不是全局VCI
- 对于数据报，路由表基于分组的目的地址来决定下一跳

### 分级路由

与“平面路由”概念相对。彼此相距很近的主机应该具有相同的前缀，这样，路由表只需要检查地址的一部分信息就可以进行路由，可以节省路由表尺寸。

实例：IP地址分为两部分，第一部分时网络标识符，第二部分是用啦识别网络中的主机的。主机部分又可以进一步划分为子网标识符和主机标识符

#### 特殊路由方法：泛洪

 将传入的分组转发到除了接收分组的端口之外的所有端口。适用于无路由表可用或发送广播分组的情况。

产生广播风暴的问题，如何解决？

- 生存期(TTL, Time-to-Live) 字段限制跳数来限制 范围。 
- 每个交换机在洪泛之前将其标识加到分组头部； 交换机丢弃头部有该交换机标识的分组。 
- 特定源的每个分组给定一个序列号; 交换机记录 源地址 source address和序列号，丢弃重复的分组。

### 最短路径路由

#### Bellman-Ford 算法

这是一种距离矢量Distance Vector协议，是一种分布式算法

![image-20250110100654631](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20250110100654631.png)

> [!NOTE]
>
> 需要掌握算法的运行过程，以及故障后的更新过程

问题是：“好事传千里，坏事不出门”。补救方法有水平分割法和毒性反转的水平分割法。但是没有一种算法能在所有情况下保证正常工作

1. 水平分割法 Split Horizon − 到X的距离不向真正通向X的邻居结点报告  
2. 毒性反转的水平分割法Split Horizon with Poison Reverse − 向真正通向X的邻居结点报告到X的距离为无穷  − 可以消除直接循环网络问题，对于非直接环路网络无效

#### Dijkstra 算法

这是一种链路状态算法，，要求所有链路的成本对算法都是可用的。每个源节点获得到其他所有节点的最短路径

![image-20250110101531333](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20250110101531333.png)

Di指的是源节点到第i个节点的最短距离

![image-20250110101652893](C:\Users\Leo\AppData\Roaming\Typora\typora-user-images\image-20250110101652893.png)

> [!NOTE]
>
> 要求会像上图一样，用源到某节点的距离和前驱节点来填表，并生成路由表

对于链路中断的响应：路由器将链路距离设置为无穷， 并向网络洪泛发送一个更新数据报，所有路由器立即更新其链接数据库并重新计算其最短路径，恢复得很快

两种算法对比，链路状态算法更好：更快，且没有收敛问题；支持精确度量或多度量标准；支持到目标多条路径

#### 源选路由

由源主机决定数据包转发路径

严格源路由：源主机规定好到目的地路径上每一个节点应该是谁

松散源路由：源主机可能不知道完整的网络信息，只规定经过路径上的部分节点，由这些节点再来决定要怎么走
